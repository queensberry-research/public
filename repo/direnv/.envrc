#!/usr/bin/env sh
# shellcheck disable=SC1090

# echo
echo_date() { echo "[$(date +'%Y-%m-%d %H:%M:%S')] $*" >&2; }

# age
export AGE_RECIPIENT='age1wtv7d6qtzl43a6vgc0ahr3esk349t40szdyysu0cd84uvxm0e33sgksukd'

# pytest
export PY_COLORS='1'

# subnet
if [ -z "$SUBNET" ]; then
	echo_date "ERROR: 'SUBNET' is undefined"
fi

# uv
export UV_MANAGED_PYTHON='true'
export UV_PRERELEASE='disallow'
export UV_PYTHON='3.13'
activate='.venv/bin/activate'
if [ -f "$activate" ]; then
	. "$activate"
else
	if command -v uv >/dev/null 2>&1; then
		uv venv
	else
		echo_date "ERROR: 'uv' is needed to create the virtual environment"
	fi
fi
if command -v uv >/dev/null 2>&1; then
	uv sync --all-extras --all-groups --active --locked
else
	echo_date "ERROR: 'uv' is needed to synchronize the virtual environment"
fi
